const querystring = require('querystring');
const request = require('request');

module.exports = function searchId(name) {
  return new Promise((resolve, reject) => {
    var query = querystring.stringify({ query: name });
    request(`https://www.youtube.com/results?search_query=${query}`, (error, response, body) => {
      if (error) {
        reject(new Error('Request error'));
        return;
      }
      let id = body.match(/https:\/\/i\.ytimg\.com\/vi\/((?:.)*?)\//);
      if (id === null) {
        reject(new Error('Video doesn\'t exist or request error'));
        return;
      }
      resolve(id[1]);
    });
  });
};
